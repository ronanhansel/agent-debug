Environment constraints:

CRITICAL ISSUES:
1. R packages 'tidyverse', 'haven', and 'bsts' are missing
2. Conda TOS blocks default Anaconda channels
3. Output directories under ../results are not created
4. run.sh helper script is missing

INSTRUCTIONS:
- Do NOT use `apt-get` (blocked).
- Use conda (env `base`) with conda-forge channel EXCLUSIVELY.
- Do NOT depend on run.sh - run R scripts directly with Rscript.

REQUIRED R PACKAGES:
- tidyverse (meta-package including ggplot2, dplyr, tidyr, readr, purrr, etc.)
- haven (for reading SPSS/Stata/SAS files)
- bsts (Bayesian Structural Time Series)

PACKAGE INSTALLATION:
Via conda (preferred):
```
conda install -c conda-forge r-tidyverse r-haven r-bsts
```

If bsts is not available via conda:
```R
install.packages("bsts", repos="https://cloud.r-project.org")
```

DIRECTORY SETUP (CRITICAL):
The scripts expect these directories under ../results. Create them:
```
mkdir -p ./results/tables
mkdir -p ./results/figures
mkdir -p ./results/for_publication/tables
mkdir -p ./results/for_publication/figures
```

If scripts reference ../results, create symlink:
```
ln -sf "$(pwd)/results" ../results 2>/dev/null || true
```

SETUP:
1. Create writable R library: `mkdir -p ./.R/library && export R_LIBS_USER=./.R/library`
2. Create all output directories as above
3. Install packages

VERIFICATION:
```
Rscript -e "library(tidyverse); library(haven); library(bsts); print('All packages OK')"
```

EXECUTION:
Run R scripts directly (not via run.sh) using `Rscript --vanilla script.R` with echo TRUE if needed:
```
Rscript --vanilla code/01_analysis.R  # or whatever the script names are
```

OUTPUT: All results go to `./results` and its subdirectories.
